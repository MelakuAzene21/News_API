generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  author
  reader
}

enum ArticleStatus {
  Draft
  Published
}

model User {
  id         String    @id @default(uuid())
  name       String
  email      String    @unique
  password   String
  role       Role
  articles   Article[]
  readLogs   ReadLog[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@map("users")
}

model Article {
  id           String          @id @default(uuid())
  title        String          @db.VarChar(150)
  content      String          @db.Text
  category     String
  status       ArticleStatus   @default(Draft)
  authorId     String
  author       User            @relation(fields: [authorId], references: [id])
  readLogs     ReadLog[]
  analytics    DailyAnalytics[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  deletedAt    DateTime?

  @@map("articles")
}

model ReadLog {
  id         String   @id @default(uuid())
  articleId  String
  article    Article  @relation(fields: [articleId], references: [id])
  readerId   String?
  reader     User?    @relation(fields: [readerId], references: [id])
  readAt     DateTime @default(now())

  @@map("read_logs")
}

model DailyAnalytics {
  id         String   @id @default(uuid())
  articleId  String
  article    Article  @relation(fields: [articleId], references: [id])
  viewCount  Int      @default(0)
  date       DateTime @db.Date

  @@unique([articleId, date])
  @@map("daily_analytics")
}